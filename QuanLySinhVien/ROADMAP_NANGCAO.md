# H·ªÜ TH·ªêNG QU·∫¢N L√ù ƒê√ÄO T·∫†O - PHI√äN B·∫¢N N√ÇNG CAO

## üéì T·ªîNG QUAN

H·ªá th·ªëng ƒë√£ ƒë∆∞·ª£c n√¢ng c·∫•p t·ª´ **qu·∫£n l√Ω sinh vi√™n ƒë∆°n gi·∫£n** l√™n **h·ªá th·ªëng qu·∫£n l√Ω ƒë√†o t·∫°o ƒë·∫ßy ƒë·ªß** c·ªßa m·ªôt tr∆∞·ªùng ƒë·∫°i h·ªçc.

## ‚úÖ ƒê√É HO√ÄN TH√ÄNH

### 1. Protocol Layer (Giao th·ª©c m·ªü r·ªông)
- ‚úÖ **UserRole** enum: ADMIN, GIANG_VIEN, SINH_VIEN
- ‚úÖ **Command** m·ªü r·ªông: 60+ commands cho t·∫•t c·∫£ ch·ª©c nƒÉng
  - X√°c th·ª±c: LOGIN, LOGOUT
  - Qu·∫£n l√Ω: KHOA_*, LOPHOC_*, GIANGVIEN_*, MONHOC_*, HOCKY_*, LOPHOCPHAN_*
  - Nghi·ªáp v·ª• SV: SV_REGISTER_COURSE, SV_GET_TRANSCRIPT
  - Nghi·ªáp v·ª• GV: GV_ENTER_GRADE, GV_GET_MY_CLASSES
- ‚úÖ **Status** m·ªü r·ªông: UNAUTHORIZED, FORBIDDEN
- ‚úÖ **Request** v·ªõi authToken field

### 2. DTO Layer (Data Transfer Objects)
- ‚úÖ LoginDTO - Th√¥ng tin ƒëƒÉng nh·∫≠p
- ‚úÖ AuthResponseDTO - Ph·∫£n h·ªìi sau login (ch·ª©a token)
- ‚úÖ KhoaDTO - Khoa/Department
- ‚úÖ LopHocDTO - L·ªõp h√†nh ch√≠nh
- ‚úÖ GiangVienDTO - Gi·∫£ng vi√™n
- ‚úÖ MonHocDTO - M√¥n h·ªçc

### 3. H·ªá th·ªëng hi·ªán t·∫°i (ƒëang ho·∫°t ƒë·ªông)
- ‚úÖ Server v·ªõi in-memory mode
- ‚úÖ GUI Client (MainFrame + StudentDialog)
- ‚úÖ SinhVienDTO + basic CRUD

## üöß C·∫¶N TRI·ªÇN KHAI TI·∫æP

### GIAI ƒêO·∫†N 3: Entity Layer (JPA Entities)
**10 Entity classes c·∫ßn t·∫°o:**

1. **TaiKhoan** (Account) - B·∫ÆT BU·ªòC
   - username (PK)
   - password (hashed)
   - role (UserRole enum)
   - @OneToOne sinhVien / giangVien

2. **Khoa** (Faculty)
   - maKhoa (PK)
   - tenKhoa
   - @OneToMany dsLopHoc, dsGiangVien, dsMonHoc

3. **LopHoc** (Administrative Class)
   - maLop (PK)
   - tenLop, nienKhoa
   - @ManyToOne khoa
   - @OneToMany dsSinhVien

4. **SinhVien** (Student) - C·∫≠p nh·∫≠t
   - maSV (PK)
   - @ManyToOne lopHoc
   - @OneToOne taiKhoan
   - @OneToMany dsDiem

5. **GiangVien** (Lecturer)
   - maGV (PK)
   - hoTen, hocVi
   - @ManyToOne khoa
   - @OneToOne taiKhoan
   - @OneToMany dsLopHocPhan

6. **MonHoc** (Course)
   - maMH (PK)
   - tenMH, soTinChi
   - @ManyToOne khoa
   - @OneToMany dsLopHocPhan

7. **HocKy** (Semester)
   - maHocKy (PK)
   - tenHocKy, ngayBatDau, ngayKetThuc
   - @OneToMany dsLopHocPhan

8. **LopHocPhan** (Course Section)
   - maLHP (PK, auto-increment)
   - @ManyToOne monHoc, giangVien, hocKy
   - soLuongToiDa
   - @OneToMany dsDiem

9. **Diem** (Grade) - Composite Key
   - @EmbeddedId DiemId
   - @ManyToOne sinhVien, lopHocPhan
   - diemChuyenCan, diemGiuaKy, diemCuoiKy, diemTongKet

10. **DiemId** (Composite Key)
    - @Embeddable
    - maSV + maLHP

### GIAI ƒêO·∫†N 4: Service Layer
**Services c·∫ßn t·∫°o:**

1. **AuthService**
   - login(username, password) ‚Üí AuthResponseDTO
   - logout(token)
   - validateToken(token) ‚Üí UserInfo
   - S·ª≠ d·ª•ng BCrypt ƒë·ªÉ hash/verify password

2. **KhoaService**
   - addKhoa(KhoaDTO)
   - updateKhoa(KhoaDTO)
   - deleteKhoa(maKhoa)
   - getAllKhoa() ‚Üí List<KhoaDTO>

3. **LopHocService**
   - CRUD cho LopHoc
   - getAllByKhoa(maKhoa)

4. **GiangVienService**
   - CRUD cho GiangVien
   - getAllByKhoa(maKhoa)

5. **MonHocService**
   - CRUD cho MonHoc
   - getAllByKhoa(maKhoa)

6. **HocVuService** (Nghi·ªáp v·ª• ph·ª©c t·∫°p)
   - moLopHocPhan(...)
   - dangKyHocPhan(maSV, maLHP)
   - nhapDiem(maGV, DiemDTO)
   - xemBangDiem(maSV) ‚Üí BangDiemDTO

### GIAI ƒêO·∫†N 5: Server Update
**C·∫≠p nh·∫≠t ClientHandler:**
- Th√™m x√°c th·ª±c token cho m·ªçi request
- Ki·ªÉm tra ph√¢n quy·ªÅn (ADMIN, GIANG_VIEN, SINH_VIEN)
- Route commands ƒë·∫øn c√°c service t∆∞∆°ng ·ª©ng

**C·∫≠p nh·∫≠t persistence.xml:**
- Khai b√°o t·∫•t c·∫£ 10 Entity classes

### GIAI ƒêO·∫†N 6: GUI Client N√¢ng cao
**MainFrame s·ª≠ d·ª•ng JTabbedPane:**

Tab 1: **Qu·∫£n l√Ω Khoa**
- JTable hi·ªÉn th·ªã danh s√°ch Khoa
- N√∫t: Th√™m, S·ª≠a, X√≥a

Tab 2: **Qu·∫£n l√Ω L·ªõp**
- ComboBox ch·ªçn Khoa
- JTable hi·ªÉn th·ªã L·ªõp thu·ªôc Khoa
- N√∫t: Th√™m, S·ª≠a, X√≥a

Tab 3: **Qu·∫£n l√Ω Sinh vi√™n**
- ComboBox ch·ªçn L·ªõp
- JTable hi·ªÉn th·ªã SV thu·ªôc L·ªõp
- N√∫t: Th√™m, S·ª≠a, X√≥a

Tab 4: **Qu·∫£n l√Ω Gi·∫£ng vi√™n**
- ComboBox ch·ªçn Khoa
- JTable hi·ªÉn th·ªã GV thu·ªôc Khoa

Tab 5: **Qu·∫£n l√Ω M√¥n h·ªçc**
- ComboBox ch·ªçn Khoa
- JTable hi·ªÉn th·ªã M√¥n h·ªçc

Tab 6: **Qu·∫£n l√Ω ƒê√†o t·∫°o**
- ComboBox ch·ªçn H·ªçc k·ª≥
- JTable hi·ªÉn th·ªã L·ªõp h·ªçc ph·∫ßn
- N√∫t: M·ªü l·ªõp m·ªõi

Tab 7: **T√†i kho·∫£n**
- JTable hi·ªÉn th·ªã T√†i kho·∫£n
- N√∫t: Th√™m, ƒê·ªïi m·∫≠t kh·∫©u, X√≥a

**Login Screen:**
- JDialog login tr∆∞·ªõc khi v√†o MainFrame
- Nh·∫≠p username/password
- L∆∞u authToken sau khi login th√†nh c√¥ng
- M·ªçi request ƒë·ªÅu g·ª≠i k√®m token

## üìã L·ªò TR√åNH TRI·ªÇN KHAI ƒê·ªÄ XU·∫§T

### Tu·∫ßn 1: Entity + JPA
1. T·∫°o 10 Entity classes
2. C·∫≠p nh·∫≠t persistence.xml
3. Test JPA v·ªõi database

### Tu·∫ßn 2: Service Layer
1. Implement AuthService (quan tr·ªçng nh·∫•t)
2. Implement c√°c CRUD Services (Khoa, LopHoc, GiangVien, MonHoc)
3. Test t·ª´ng service ri√™ng l·∫ª

### Tu·∫ßn 3: Server Integration
1. C·∫≠p nh·∫≠t ClientHandler v·ªõi authentication
2. C·∫≠p nh·∫≠t ClientHandler v·ªõi authorization
3. Route commands ƒë·∫øn services
4. Test v·ªõi Postman ho·∫∑c test client

### Tu·∫ßn 4: GUI Client
1. T·∫°o LoginDialog
2. C·∫≠p nh·∫≠t MainFrame v·ªõi JTabbedPane
3. T·∫°o c√°c Dialog cho t·ª´ng entity
4. Test end-to-end

## üéØ PH·∫†M VI T·ªêI THI·ªÇU (MVP)

N·∫øu th·ªùi gian h·∫°n ch·∫ø, t·∫≠p trung v√†o:

### Core Features (B·∫ÆT BU·ªòC)
1. ‚úÖ Login/Logout v·ªõi token
2. ‚úÖ Qu·∫£n l√Ω Khoa (CRUD)
3. ‚úÖ Qu·∫£n l√Ω L·ªõp (CRUD)
4. ‚úÖ Qu·∫£n l√Ω Sinh vi√™n (CRUD) - ƒë√£ c√≥
5. ‚úÖ Ph√¢n quy·ªÅn c∆° b·∫£n (ADMIN vs non-ADMIN)

### Advanced Features (N√äN C√ì)
6. Qu·∫£n l√Ω Gi·∫£ng vi√™n
7. Qu·∫£n l√Ω M√¥n h·ªçc
8. M·ªü l·ªõp h·ªçc ph·∫ßn
9. Sinh vi√™n ƒëƒÉng k√Ω h·ªçc ph·∫ßn
10. Gi·∫£ng vi√™n nh·∫≠p ƒëi·ªÉm

## üí° G·ª¢I √ù C√îNG NGH·ªÜ

### Security
```java
// S·ª≠ d·ª•ng BCrypt cho password
import org.mindrot.jbcrypt.BCrypt;

String hashedPassword = BCrypt.hashpw(plainPassword, BCrypt.gensalt());
boolean isValid = BCrypt.checkpw(plainPassword, hashedPassword);
```

Th√™m dependency v√†o pom.xml:
```xml
<dependency>
    <groupId>org.mindrot</groupId>
    <artifactId>jbcrypt</artifactId>
    <version>0.4</version>
</dependency>
```

### Token Management
```java
// Simple UUID token
String token = UUID.randomUUID().toString();

// L∆∞u trong ConcurrentHashMap
Map<String, String> tokenStore = new ConcurrentHashMap<>();
tokenStore.put(token, username);
```

### JPA Relationships
```java
// Khoa.java
@OneToMany(mappedBy="khoa", cascade=CascadeType.ALL)
private List<LopHoc> dsLopHoc;

// LopHoc.java
@ManyToOne
@JoinColumn(name="ma_khoa")
private Khoa khoa;
```

## üìä DATABASE SCHEMA

```sql
-- Khoa
CREATE TABLE khoa (
    ma_khoa VARCHAR(10) PRIMARY KEY,
    ten_khoa NVARCHAR(100) NOT NULL
);

-- LopHoc
CREATE TABLE lop_hoc (
    ma_lop VARCHAR(20) PRIMARY KEY,
    ten_lop NVARCHAR(100) NOT NULL,
    nien_khoa VARCHAR(20),
    ma_khoa VARCHAR(10),
    FOREIGN KEY (ma_khoa) REFERENCES khoa(ma_khoa)
);

-- SinhVien
CREATE TABLE sinh_vien (
    ma_sv VARCHAR(20) PRIMARY KEY,
    ho_ten NVARCHAR(100) NOT NULL,
    ngay_sinh DATE,
    gioi_tinh VARCHAR(10),
    chuyen_nganh NVARCHAR(50),
    ma_lop VARCHAR(20),
    diem_tb FLOAT,
    FOREIGN KEY (ma_lop) REFERENCES lop_hoc(ma_lop)
);

-- TaiKhoan
CREATE TABLE tai_khoan (
    username VARCHAR(50) PRIMARY KEY,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(20) NOT NULL,
    ma_sv VARCHAR(20),
    ma_gv VARCHAR(20),
    FOREIGN KEY (ma_sv) REFERENCES sinh_vien(ma_sv),
    FOREIGN KEY (ma_gv) REFERENCES giang_vien(ma_gv)
);
```

## üîß H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG

### 1. Ch·∫°y Server
```bash
# ƒê·∫£m b·∫£o SKIP_JPA = false n·∫øu d√πng database
# ho·∫∑c SKIP_JPA = true ƒë·ªÉ d√πng in-memory
mvn exec:java -Dexec.mainClass="iuh.fit.se.server.Server"
```

### 2. Ch·∫°y GUI Client
```bash
mvn exec:java -Dexec.mainClass="iuh.fit.se.client.gui.MainFrame"
```

### 3. Login m·∫∑c ƒë·ªãnh
```
Username: admin
Password: admin123
Role: ADMIN
```

## üìù K·∫æT LU·∫¨N

H·ªá th·ªëng hi·ªán t·∫°i ƒë√£ c√≥ **n·ªÅn t·∫£ng v·ªØng ch·∫Øc**:
- ‚úÖ Protocol ƒë·∫ßy ƒë·ªß (60+ commands)
- ‚úÖ DTO layer ho√†n ch·ªânh
- ‚úÖ GUI framework s·∫µn s√†ng

C√≤n c·∫ßn tri·ªÉn khai:
- üöß 10 Entity classes (JPA)
- üöß 6 Service classes
- üöß Authentication & Authorization
- üöß GUI n√¢ng cao v·ªõi JTabbedPane

**∆Ø·ªõc t√≠nh th·ªùi gian:** 20-30 gi·ªù cho full implementation

**Khuy·∫øn ngh·ªã:** Tri·ªÉn khai theo t·ª´ng giai ƒëo·∫°n, test k·ªπ m·ªói ph·∫ßn tr∆∞·ªõc khi sang ph·∫ßn ti·∫øp theo.

